(function(){this.GAME_HEIGHT=600;this.GAME_WIDTH=800;this.INCOMING_PLANE_VELOCITY=300;this.CLOUD_VELOCITY=75;this.SHAKE_VELOCITY=10;this.SHAKE_HEIGHT=20;this.LIGHTNING_TIME=0.2;this.LIGHTNING_PROB=2/60;this.LIGHTNING_DAMAGE=3;this.CLOUD_SPAWN_X_EXTRA=300;this.SCORE_PER_SECOND=10;this.LEVEL1={time:30,planes:30,clouds:40,f_lightning:0.1,turbulence:5};this.TIME_INCREASE=5;this.PLANES_INCREASE=10;this.CLOUDS_INCREASE=10;this.F_LIGHTNING_INCREASE=0.01;this.TURBULENCE_INCREASE=10}).call(this);(function(){this.Boot=(function(){function a(b){}a.prototype.preload=function(){HealthBar.preload(this.game);this.game.stage.setBackgroundColor("rgb(135,206,250)");return this.game.world.setBounds(0,0,2000,2000)};a.prototype.create=function(){return this.state.start("Preloader")};return a})();this.Preloader=(function(){function a(b){}a.prototype.preload=function(){var b,d,c,e;b=this.add.sprite(GAME_WIDTH/2,GAME_HEIGHT/2,"health_bar_back");b.anchor.setTo(0.5,0.5);d=this.add.sprite(GAME_WIDTH/2,GAME_HEIGHT/2,"health_bar_front");d.anchor.setTo(0,0.5);d.x=GAME_WIDTH/2-d.width/2;this.load.setPreloadSprite(d);c={font:"48px Arial",fill:"rgb(0,0,0)",align:"center"};e=this.game.add.text(GAME_WIDTH/2,GAME_HEIGHT/2-100,"Loading...",c);e.anchor.set(0.5);Obstacles.preload(this.game);Player.preload(this.game);return Menu.preload_assets(this.game)};a.prototype.create=function(){return this.game.state.start("Menu")};return a})()}).call(this);(function(){this.Menu=(function(){function a(b){}a.preload_assets=function(b){b.load.image("button","sprites/button.png");b.load.image("try_again","sprites/try_again.png");return b.load.image("next_level","sprites/next_level.png")};a.prototype.create=function(){var b,c;this.game.add.button(GAME_WIDTH/2-76,300,"button",this.on_play_now);b={font:"100px Arial",fill:"rgb(0,0,0)",align:"center"};c=this.game.add.text(GAME_WIDTH/2,GAME_HEIGHT/2-100,"Flying Game",b);return c.anchor.set(0.5)};a.prototype.on_play_now=function(){return this.game.state.start("Game",true,false,1)};return a})()}).call(this);(function(){var a=function(b,c){return function(){return b.apply(c,arguments)}};this.LevelComplete=(function(){function b(c){this.begin_next_level=a(this.begin_next_level,this)}b.prototype.init=function(c){return this.level_number=c};b.prototype.create=function(){var d,c,e,f;e={font:"100px Arial",fill:"rgb(0,0,0)",align:"center"};f="Level "+this.level_number+" Complete";d=this.game.add.text(GAME_WIDTH/2,GAME_HEIGHT/2-100,f,e);d.anchor.set(0.5);c=this.game.add.button(0,300,"next_level",this.begin_next_level);return c.x=GAME_WIDTH/2-c.width/2};b.prototype.begin_next_level=function(){return this.game.state.start("Game",true,false,this.level_number+1)};return b})();this.GameOver=(function(){function b(c){}b.prototype.create=function(){var e,c,d;d={font:"76px Arial",fill:"rgb(0,0,0)",align:"center"};e=this.game.add.text(GAME_WIDTH/2,GAME_HEIGHT/2-100,"Game Over",d);e.anchor.set(0.5);return c=this.game.add.button(GAME_WIDTH/2-76,300,"try_again",(function(f){return function(){return f.game.state.start("Game",true,false,1)}})(this))};return b})()}).call(this);(function(){this.Level=(function(){function a(b){this.obstacles=b}a.prototype.generate_level_objects=function(f){var b,e,d,c;e=Math.round(f.time/60*f.planes);c=f.time*INCOMING_PLANE_VELOCITY;this.obstacles.planes_level(e,GAME_WIDTH,c,0,GAME_HEIGHT-100);b=Math.round(f.time/60*f.clouds);c=f.time*CLOUD_VELOCITY+CLOUD_SPAWN_X_EXTRA;this.obstacles.clouds_level(b,GAME_WIDTH,c,0,GAME_HEIGHT-100,f.f_lightning);d=Math.round(f.time/60*f.turbulence);return this.obstacles.turbulence_level(d,GAME_WIDTH,c,0,GAME_HEIGHT-100)};a.prototype.generate_level=function(d){var c,b;b=d-1;c={time:LEVEL1.time+b*TIME_INCREASE,planes:LEVEL1.planes+b*PLANES_INCREASE,clouds:LEVEL1.clouds+b*CLOUDS_INCREASE,f_lightning:LEVEL1.f_lightning+b*F_LIGHTNING_INCREASE,turbulence:LEVEL1.turbulence+b*TURBULENCE_INCREASE};return this.generate_level_objects(c)};return a})()}).call(this);(function(){var a=function(b,c){return function(){return b.apply(c,arguments)}};this.Obstacles=(function(){b.preload=function(c){c.load.image("oncoming_plane_body","sprites/airplane_flipped_body.png");c.load.image("oncoming_plane_tail","sprites/airplane_flipped_tail.png");c.load.image("cloud","sprites/cloud.png");c.load.image("storm_cloud","sprites/storm_cloud.png");c.load.image("fog","sprites/fog.png");c.load.image("turbulence","sprites/wind.png");return c.load.image("lightning","sprites/lightning.png")};function b(c,d,e){this.game=c;this.player=d;this.level=e;this.create_lightning=a(this.create_lightning,this);this.create_turbulence=a(this.create_turbulence,this);this.create_storm_cloud=a(this.create_storm_cloud,this);this.create_cloud=a(this.create_cloud,this);this.create_plane=a(this.create_plane,this);this.clouds_last_overlapped=0;this.turbulence_last_overlapped=0;this.camera_direction_positive=true;this.last_shake_time=0;this.level_object=new Level(this)}b.prototype.setup=function(){this.clouds=this.game.add.group();this.turbulence=this.game.add.group();this.planes=this.game.add.group();this.lightning=this.game.add.group();this.planes.enableBody=true;this.clouds.enableBody=true;this.turbulence.enableBody=true;this.lightning.enableBody=true;this.fog=this.game.add.image(0,0,"fog");this.fog.scale.setTo(GAME_WIDTH/10,(GAME_HEIGHT+SHAKE_HEIGHT)/10);this.fog.alpha=0.8;return this.fog.visible=false};b.prototype.create_plane=function(d,f){var c,e;e=this.planes.create(d,f,"oncoming_plane_tail");c=this.planes.create(d-78,f+23,"oncoming_plane_body");e.body.velocity.x=-INCOMING_PLANE_VELOCITY;c.body.velocity.x=-INCOMING_PLANE_VELOCITY;e.other_part=c;return c.other_part=e};b.prototype.create_cloud=function(c,e){var d;d=this.clouds.create(c,e,"cloud");d.scale.setTo(2,2);return d.body.velocity.x=-CLOUD_VELOCITY};b.prototype.create_storm_cloud=function(c,e){var d;d=this.clouds.create(c,e,"storm_cloud");d.scale.setTo(2,2);return d.body.velocity.x=-CLOUD_VELOCITY};b.prototype.create_turbulence=function(c,e){var d;d=this.turbulence.create(c,e,"turbulence");return d.body.velocity.x=-CLOUD_VELOCITY};b.prototype.create_lightning=function(c,e){var d;d=this.lightning.create(c,e,"lightning");return d.created_at=this.game.time.now};b.prototype.create_obstacles=function(f,e,d,n,c,m){var j,l,k,h,g;g=[];for(j=h=1;1<=f?h<=f:h>=f;j=1<=f?++h:--h){l=Math.random()*(d-e)+e;k=Math.random()*(c-n)+n;g.push(m(l,k))}return g};b.prototype.clouds_level=function(e,d,g,f,c,h){this.create_obstacles(Math.round(e*(1-h)),d,g,f,c,this.create_cloud);return this.create_obstacles(Math.round(e*h),d,g,f,c,this.create_storm_cloud)};b.prototype.planes_level=function(g,d,f,e,c){return this.create_obstacles(g,d,f,e,c,this.create_plane)};b.prototype.turbulence_level=function(g,d,f,e,c){return this.create_obstacles(g,d,f,e,c,this.create_turbulence)};b.prototype.shake=function(){if((this.game.time.now-this.last_shake_time)>10){if(this.camera_direction_positive){if(this.game.camera.y===SHAKE_HEIGHT){this.camera_direction_positive=false}else{this.game.camera.y+=SHAKE_VELOCITY}}else{if(this.game.camera.y===0){this.camera_direction_positive=true}else{this.game.camera.y-=SHAKE_VELOCITY}}}return this.last_shake_time=this.game.time.now};b.prototype.show_game_over=function(){return this.game.state.start("GameOver",false,false)};b.prototype.get_random_storm_cloud=function(){var c,e,d;d=(function(){var j,h,i,f,k,g;i=this.clouds.children;g=[];for(j=0,h=i.length;j<h;j++){c=i[j];if(c.key==="storm_cloud"&&(0<(f=c.x)&&f<800)&&(0<(k=c.y)&&k<600)){g.push(c)}}return g}).call(this);if(d.length>0){e=Math.floor(Math.random()*d.length);return d[e]}};b.prototype.update_lightning=function(){var h,e,g,d,f,c;if(Math.random()<LIGHTNING_PROB){e=this.get_random_storm_cloud();if(e){this.create_lightning(e.x,e.y+e.height-10)}}f=this.lightning.children;c=[];for(g=0,d=f.length;g<d;g++){h=f[g];if(h){if((this.game.time.now-h.created_at)>(LIGHTNING_TIME*1000)){c.push(this.lightning.removeChild(h))}else{c.push(void 0)}}else{c.push(void 0)}}return c};b.prototype.offscreen_left=function(g){var d,f,c,e;e=g.children;for(f=0,c=e.length;f<c;f++){d=e[f];if((d.x+d.width)>=0){return false}}return true};b.prototype.none_right_of_coord=function(h,d){var e,g,c,f;f=h.children;for(g=0,c=f.length;g<c;g++){e=f[g];if(e.x>d){return false}}return true};b.prototype.level_complete=function(){var f,e,c,d;d=[this.clouds,this.planes,this.turbulence,this.lightning];for(e=0,c=d.length;e<c;e++){f=d[e];if(!this.offscreen_left(f)){return false}}return true};b.prototype.update=function(){if(this.none_right_of_coord(this.planes,GAME_WIDTH+100)){this.level+=1;this.level_object.generate_level(this.level)}this.game.physics.arcade.overlap(this.player.plane,this.planes,(function(c){return function(e,d){e.parent.children.forEach(function(f){return f.body.velocity.y=0});d.body.velocity.x=0;d.other_part.body.velocity.x=0;return c.show_game_over()}})(this));this.game.physics.arcade.overlap(this.player.cockpit,this.clouds,(function(c){return function(){c.fog.visible=true;return c.clouds_last_overlapped=c.game.time.now+100}})(this));if(this.game.time.now>this.clouds_last_overlapped){this.fog.visible=false}this.game.physics.arcade.overlap(this.player.body,this.turbulence,(function(c){return function(){c.shake();return c.turbulence_last_overlapped=c.game.time.now+100}})(this));if(this.game.time.now>this.turbulence_last_overlapped){this.game.camera.y=0}this.update_lightning();this.game.physics.arcade.overlap(this.player.plane,this.lightning,(function(c){return function(){return c.player.decrease_health(LIGHTNING_DAMAGE/(0.2*60))}})(this));if(this.player.health<=0){this.player.stop();return this.show_game_over()}};return b})()}).call(this);(function(){this.HealthBar=(function(){a.preload=function(b){b.load.image("health_bar_back","sprites/health_bar_background.png");return b.load.image("health_bar_front","sprites/health_bar_front.png")};function a(b){this.percentage=100;this.game=b}a.prototype.create=function(b,c){this.back=this.game.add.image(0,c,"health_bar_back");this.front=this.game.add.image(0,c,"health_bar_front");this.back.x=b-this.back.width/2;this.front.x=this.back.x;return this.create_score(20,20)};a.prototype.set_percentage=function(b){this.percentage=b;return this.front.scale.x=b/100};a.prototype.create_score=function(b,d){var c;c={font:"32px Arial",fill:"rgb(0, 0, 0)",align:"center"};return this.score_text=this.game.add.text(b,d,"Score: 0",c)};a.prototype.update_score=function(b){return this.score_text.setText("Score: "+Math.floor(b))};return a})()}).call(this);(function(){this.Player=(function(){a.preload=function(b){b.load.image("airplane_tail","sprites/airplane_tail.png");b.load.image("airplane_body","sprites/airplane_body.png");return b.load.image("airplane_cockpit","sprites/airplane_cockpit.png")};function a(b,c){this.game=b;this.health=100;this.score=0;this.health_bar=c}a.prototype.create=function(b,c){this.plane=this.game.add.group();this.tail=this.plane.create(b,c,"airplane_tail");this.body=this.plane.create(b-6,c+22,"airplane_body");this.cockpit=this.plane.create(b+128,c+23,"airplane_cockpit");this.game.physics.arcade.enable(this.tail);this.game.physics.arcade.enable(this.body);return this.game.physics.arcade.enable(this.cockpit)};a.prototype.update=function(){var c,b;c=this.game.input.keyboard.createCursorKeys();if(c.up.isDown){if(this.tail.y<=0){this.stop()}else{this.body.body.velocity.y=-100;this.tail.body.velocity.y=-100;this.cockpit.body.velocity.y=-100}}else{if(c.down.isDown){if(this.body.y+this.body.height>GAME_HEIGHT){this.stop()}else{this.body.body.velocity.y=100;this.tail.body.velocity.y=100;this.cockpit.body.velocity.y=100}}else{this.stop()}}b=this.game.time.physicsElapsed;this.score=this.score+SCORE_PER_SECOND*b;return this.health_bar.update_score(this.score)};a.prototype.stop=function(){this.body.body.velocity.y=0;this.tail.body.velocity.y=0;return this.cockpit.body.velocity.y=0};a.prototype.decrease_health=function(b){this.health-=b;if(this.health<0){this.health=0}return this.health_bar.set_percentage(this.health)};return a})()}).call(this);(function(){var a,b=function(c,d){return function(){return c.apply(d,arguments)}};this.MainGame=(function(){function c(d){this.restart=b(this.restart,this)}c.prototype.init=function(d){return this.level=d};c.prototype.create=function(){var d;this.health_bar=new HealthBar(this.game);this.player=new Player(this.game,this.health_bar);this.obstacles=new Obstacles(this.game,this.player,this.level);this.player.create(100,100);this.obstacles.setup();d=new Level(this.obstacles);d.generate_level(this.level);return this.health_bar.create(GAME_WIDTH/2,20)};c.prototype.update=function(){this.player.update();return this.obstacles.update()};c.prototype.restart=function(){return this.game.state.start("Game",true,false,this.level)};return c})();a=new Phaser.Game(800,600,Phaser.AUTO,"game");a.state.add("Boot",Boot);a.state.add("Preloader",Preloader);a.state.add("Menu",Menu);a.state.add("Game",MainGame);a.state.add("GameOver",GameOver);a.state.start("Boot")}).call(this);